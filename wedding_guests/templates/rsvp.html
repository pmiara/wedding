{% extends "base.html" %}
{% load custom_filters %}

{% block content %}
<div class="container">

{% for message in messages %}
<div class="alert alert-success alert-dismissible fade show" role="alert">
  {{ message }}
  <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
{% endfor %}

{% for dict in formset.errors %}
    {% for error in dict.values %}
        {{ error }}
    {% endfor %}
{% endfor %}

  <ul class="nav nav-tabs" role="tablist">
  {% for guest_form in formset %}
    <li role="presentation" class="nav-item">
      <a href="#tab-{{ guest_form.initial.id }}" data-toggle="tab" aria-controls="tab-{{ guest_form.initial.id }}" role="tab" data-toggle="tab" class="nav-link">
        {{ guest_form.instance }}
      </a>
    </li>
  {% endfor %}
    <li role="presentation" class="ml-auto nav-item" id="gifts-nav-tab">
      <a href="#tab-gifts" data-toggle="tab" aria-controls="tab-gifts" role="tab" data-toggle="tab" class="nav-link">
        Wybór prezentów
      </a>
    </li>
  </ul>

  <form method="post" action="">
  {% csrf_token %}
  {{ formset.management_form }}
    <div class="tab-content">
    {% for guest_form in formset %}
      <div class="tab-pane fade" id="tab-{{ guest_form.initial.id }}">
      {{ guest_form.as_my_p }}
      </div>
    {% endfor %}
      <div class="tab-pane fade" id="tab-gifts">
        <h6>Lista proponowanych prezentów</h6>
      {% for gift_id, gift_name in gift_form.gifts.field.choices %}
        <label for="id-gift-{{ gift_id }}">
          <input id="id-gift-{{ gift_id }}"
            type="checkbox"
            name="gifts"
            value="{{ gift_id }}"
            {% if gift_id in gift_form.gifts.field.initial %}
              checked=""
            {% endif %}>
          {{ gift_name }}
          {% with gift_urls|get_item:gift_id as gift_url %}
            {% if gift_url %}
            <a href="{{ gift_url }}" target="_blank">(link)</a>
            {% endif %}
          {% endwith %}
        </label>
        <br>
      {% endfor %}
      {% if gift_form.taken_gifts %}
        <h6>Zarezerwowane prezenty:</h6>
        <ul>
        {% for gift_name in gift_form.taken_gifts %}
          <li>{{ gift_name }}</li>
        {% endfor %}
        </ul>
      {% endif %}
      </div>
      <button id="rsvp-button" class="btn btn-default btn-border" type="submit">Zapisz zmiany</button>
    </div>
  </form>
</div>
{% endblock %}

{% block js %}
<script>
$("#menu-rsvp").addClass("active");
</script>

<script>
$(".nav-tabs .nav-item a").first().addClass("active");
$(".tab-content div").first().addClass("active");
</script>

<script>
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
</script>

<script>
$('.tab-pane').first().addClass('show active');
</script>
{% endblock js %}
